<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>藏语翻译APP后台管理中心</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <!--[if lt IE 9]>
    <meta http-equiv="refresh" content="0;ie.html"/>
    <![endif]-->
    <link rel="shortcut icon" type="images/x-icon" href="../../image/favicon.ico">
    <link href="../../css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="../../css/animate.css" rel="stylesheet">
    <link href="../../css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/index.css" rel="stylesheet">
    <link href="../../css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="../../css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">
    <link href="../../css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <link rel="stylesheet" href="../../font/iconfont.css">
    <link rel="stylesheet" href="../../css/public.css">
    <style>
        .power {
            padding: 25px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .power:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="graybg">
<div class="wrapper-content">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>新增角色</h5>
            <div class="ibox-tools">
                <a href="javascript:history.back(-1);" class="btn btn-white">返回列表</a>
            </div>
        </div>
        <div class="ibox-content">
            <div class="form-horizontal m-t">
                <div class="form-group  admin-mt20">
                    <label class="col-sm-2 control-label">
                        角色名称
                        <span>*</span>
                    </label>
                    <div class="col-sm-7">
                        <input class="form-control" type="text"
                               placeholder="请输入角色名称" id="roleName">
                    </div>
                </div>

                <div class="form-group  admin-mt20">
                    <label class="col-sm-2 control-label">
                        权限配置
                        <span>*</span>
                    </label>
                    <div class="col-sm-7">
                        <ul id="roleList" class="roleList">
                            <!--<li class="power">
                               &lt;!&ndash; 一级 &ndash;&gt;
                                <div class="checkbox checkbox-inline" onclick="selectAll()">
                                    <input type="checkbox" style="cursor: pointer"   class="checkAll">
                                    <label style="cursor: default;">
                                      <strong>会员管理</strong>
                                    </label>
                                </div>
                                &lt;!&ndash; 二级 &ndash;&gt;
                                <div class="m-t">
                                    <div class="checkbox checkbox-inline" style="cursor: default" onclick="checkOne()">
                                        <input type="checkbox" value="21" name="rules[]" style="cursor: pointer" class="checkOne">
                                        <label style="cursor: default">编辑会员</label>
                                    </div>
                                </div>
                            </li>
                            <li class="power">
                               &lt;!&ndash; 一级 &ndash;&gt;
                                <div class="checkbox checkbox-inline" onclick="selectAll()">
                                    <input type="checkbox" style="cursor: pointer"   class="checkAll">
                                    <label style="cursor: default;">
                                      <strong>词库管理</strong>
                                    </label>
                                </div>
                                &lt;!&ndash; 二级 &ndash;&gt;
                                <div class="m-t">
                                    <div class="checkbox checkbox-inline" style="cursor: default" onclick="checkOne()">
                                        <input type="checkbox" value="21" name="rules[]" style="cursor: pointer" class="checkOne">
                                        <label style="cursor: default">新增词库</label>
                                    </div>
                                    <div class="checkbox checkbox-inline" style="cursor: default" onclick="checkOne()">
                                        <input type="checkbox" value="21" name="rules[]" style="cursor: pointer" class="checkOne">
                                        <label style="cursor: default">编辑词库</label>
                                    </div>
                                </div>
                            </li>
                            <li class="power">
                               &lt;!&ndash; 一级 &ndash;&gt;
                                <div class="checkbox checkbox-inline" onclick="selectAll()">
                                    <input type="checkbox" style="cursor: pointer"   class="checkAll">
                                    <label style="cursor: default;">
                                      <strong>资讯中心</strong>
                                    </label>
                                </div>
                                &lt;!&ndash; 二级 &ndash;&gt;
                                <div class="m-t">
                                    <div class="checkbox checkbox-inline" style="cursor: default" onclick="checkOne()">
                                        <input type="checkbox" value="21" name="rules[]" style="cursor: pointer" class="checkOne">
                                        <label style="cursor: default">编辑资讯</label>
                                    </div>
                                    <div class="checkbox checkbox-inline" style="cursor: default" onclick="checkOne()">
                                        <input type="checkbox" value="21" name="rules[]" style="cursor: pointer" class="checkOne">
                                        <label style="cursor: default">新增资讯</label>
                                    </div>
                                </div>
                            </li>-->
                        </ul>
                    </div>
                </div>

                <div class="form-group  admin-mt20">
                    <label class="col-sm-2 control-label">
                        状态
                        <span class="white">*</span>
                    </label>
                    <div class="col-sm-7 admin-mt5">
                        <label for="yes" class="admin-mr15">
                            <input id="yes" type="radio" name="show" checked="checked" value="0">
                            <span>启用</span>
                        </label>
                        <label for="not">
                            <input id="not" type="radio" name="show" value="1">
                            <span>禁用</span>
                        </label>
                    </div>
                </div>
                <div class="form-group  admin-mt30">
                    <div class="col-sm-7 col-sm-offset-2">
                        <button class="btn btn-primary" type="button" id="submit">保存</button>
                        <a href="javascript:history.back(-1);" class="btn btn-white">返回列表</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<!-- 全局js -->
<script src="../../js/jquery.min.js?v=2.1.4"></script>
<script src="../../js/bootstrap.min.js?v=3.3.6"></script>
<script src="../../js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<!-- 自定义js -->
<!-- <script src="../../js/hplus.js?v=4.1.0"></script> -->
<script type="text/javascript" src="../../js/contabs.js"></script>
<!-- Chosen -->
<script src="../../js/plugins/chosen/chosen.jquery.js"></script>
<!-- JSKnob -->
<!-- Input Mask-->
<script src="../../js/plugins/jasny/jasny-bootstrap.min.js"></script>
<!-- suggest -->
<script src="../../js/plugins/suggest/bootstrap-suggest.min.js"></script>
<script src="../../js/common.js"></script>
<script src="../../layer/layer.js"></script>
<script src="../../layui/layui.js"></script>
<script th:inline="javascript">
    //全选
    /* $('.power').each(function () {
         var _this = $(this);
         $(this).find('.checkAll').click(function () {
             //              alert(1)
             _this.find('.checkOne').prop('checked', $(this).prop('checked'))
         })
     })*/

    //单选
    function checkAll() {
        $('.power').each(function () {

            var _this = $(this);
            var ca = $(this).find('.checkAll')

            console.log(ca.prop("checked"))

            $(this).find('.checkAll').click(function () {
                _this.find('.checkOne').prop('checked', ca.prop("checked"))
            })

        })

    }

    function checkOne() {
        $('.power').each(function () {
            var co = $(this).find('.checkOne')
            var ca = $(this).find('.checkAll')
            var f = true
            for (let i = 0; i < co.length; i++) {
                if (co[i].checked != f) {
                    ca.prop("checked", false)
                    break;
                }
                ca.prop("checked", f)
            }
        })

    }



    var manageResourceDTOList = [[${manageResourceDTOList}]];


    $(function () {
        var temp = "";
        var len = manageResourceDTOList.length;
        for (var j = 0, len = manageResourceDTOList.length; j < len; j++) {
            var manageResourceDTO = manageResourceDTOList[j];
            var parentName = manageResourceDTO.parentName;
            var resourceList = manageResourceDTO.resourceList;

            temp = temp + " <li class=\"power\">" +
                "<div  class=\"checkbox checkbox-inline\" onclick=\"checkAll()\">" +
                "<input  type=\"checkbox\" style=\"cursor: pointer\"   class=\"checkAll\">" +
                "<label style=\"cursor: default;\"><strong>" + parentName + "</strong></label></div>";

            temp = temp + "<div class=\"m-t\">";


            for (var i = 0, len2 = resourceList.length; i < len2; i++) {

                var resource = resourceList[i];
                var id = resource.id;
                var resourceName = resource.resourceName;

                temp = temp + " <div class=\"checkbox checkbox-inline\" style=\"cursor: default\" onclick=\"checkOne()\">\n" +
                    "        <input type=\"checkbox\" value=" + id + " name=\"rules[]\" style=\"cursor: pointer\" class=\"checkOne\">\n" +
                    "        <label style=\"cursor: default\">" + resourceName + "</label>\n" +
                    "        </div>";


            }
            temp = temp + "</div>";
            temp = temp + "</li>";


        }
        $("#roleList").append(temp);


    });



    //点击保存
    $('#submit').click(function () {


        var roleName = $('#roleName').val();
        var status = $("input[type='radio']:checked").val();
        var resoureId = "";

        $('.power').each(function () {
            var co = $(this).find('.checkOne')
            var f = true
            for (let i = 0; i < co.length; i++) {
                if (co[i].checked == f) {
                    resoureId += co[i].value + ","
                }
            }
        })
        console.log(resoureId);


        $.ajax({
            url: "/manage/user/addRole",
            data: {
                "roleName": roleName,
                "status": status,
                "resoureId": resoureId,

            },
            dataType: 'json',
            type: 'post',
            success: function (res) {
                console.log(res)
                if (res.code == 0) {
                    layer.msg("保存成功");
                    window.location.href = '/manage/system/roleIndex'
                } else {
                    // $('#verifycode_img').attr('src','/captcha?seed='+Math.random());
                    layer.msg(res.msg);
                }
            },
            err: function (res) {
                console.log(res);
            }
        })
    });
</script>
</html>
